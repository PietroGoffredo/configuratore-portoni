/* --- CANVAS FRAME --- */
.canvas-frame {
  width: 100%; flex: 1; min-height: 0; position: relative; margin-top: 0; z-index: 10; cursor: grab; touch-action: none; overscroll-behavior: none;
}
.canvas-frame:active { cursor: grabbing; }
.canvas-inner-wrapper {
  position: relative; width: 100%; height: 100%; border-radius: 12px; overflow: hidden; background: #f4f4f4; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03); z-index: 1; touch-action: none; overscroll-behavior: none;
}
.canvas-zoom-container { width: 100%; height: 100%; will-change: transform; }
.canvas-zoom-container canvas { display: block; width: 100% !important; height: 100% !important; outline: none; }

/* Cursors & Overlays */
.cursor-zoom-in { cursor: zoom-in !important; }
.cursor-grab { cursor: grab !important; }
.cursor-grabbing { cursor: grabbing !important; }
.scenario-fade-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 13; pointer-events: none; opacity: 1; transition: opacity 0.5s ease-in-out; }
.scenario-fade-overlay.faded { opacity: 0; }
.scenario-transition-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 12; pointer-events: none; }
.blackout-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000000; z-index: 15; opacity: 0; pointer-events: none; transition: opacity 0.5s ease-in-out; }
.blackout-overlay.active { opacity: 1; pointer-events: auto; }
.mode-switch-overlay, .initial-loader-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(2px); z-index: 50; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.4s ease; }
.mode-switch-overlay.active { opacity: 1; visibility: visible; }
.initial-loader-overlay { z-index: 999; opacity: 1; visibility: visible; }
.initial-loader-overlay.faded { opacity: 0; visibility: hidden; backdrop-filter: blur(0px); }

/* Fullscreen */
.canvas-frame:fullscreen { width: 100vw; height: 100vh; margin: 0; padding: 0; display: flex; }
.canvas-frame:fullscreen .canvas-inner-wrapper { border-radius: 0; }
.canvas-frame:-webkit-full-screen { width: 100%; height: 100%; margin: 0; }
.canvas-frame:-webkit-full-screen .canvas-inner-wrapper { border-radius: 0; }

/* UI Buttons & Controls */
.canvas-ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20; }
.ui-btn { pointer-events: auto; cursor: pointer; display: flex; align-items: center; justify-content: center; background-color: var(--col-white-1); color: var(--col-black-2); border: 2px solid transparent; transition: all 0.3s ease; width: 55px; height: 55px; border-radius: 6px; position: relative; overflow: visible; }
.ui-btn:hover { background-color: var(--col-white-3); }
.ui-btn.active { border-color: var(--col-gold); color: var(--col-gold); }
.ui-btn:disabled { cursor: default; }
.ui-btn::after { content: attr(data-label); position: absolute; top: 95%; left: 50%; transform: translateX(-50%); background-color: var(--col-white-1); color: var(--col-black-2); padding: 7px 10px; font-size: 0.75rem; font-weight: 500; white-space: nowrap; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid var(--col-white-2); border-radius: 4px; pointer-events: none; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.2s ease; }
.ui-btn:hover::after { opacity: 1; visibility: visible; top: 105%; transition-delay: 0.8s; }
.ui-btn:active::after, .ui-btn:focus::after { opacity: 0 !important; visibility: hidden !important; transition: none !important; }

/* Specific Placements */
.btn-fullscreen { position: absolute; top: 15px; right: 15px; }
.view-controls-vertical { position: absolute; top: 50%; left: 15px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; transition: all 0.4s ease; }
.view-controls-vertical.hidden-controls { opacity: 0; visibility: hidden; pointer-events: none; }
.bottom-left-controls { position: absolute; bottom: 15px; left: 15px; display: flex; gap: 10px; z-index: 25; pointer-events: none; }
.bottom-left-controls > * { pointer-events: auto; }
.bottom-right-controls { position: absolute; bottom: 15px; right: 15px; z-index: 25; pointer-events: auto; }

/* Scenario Menu */
.scenario-control-container { position: relative; display: flex; flex-direction: column; }
.scenario-popup-menu { position: absolute; bottom: 100%; left: 0; margin-bottom: 10px; display: flex; flex-direction: column; gap: 6px; background-color: var(--col-white-1); padding: 8px; border-radius: 8px; box-shadow: 0 3px 12px rgba(0,0,0,0.1); z-index: 100; opacity: 0; visibility: hidden; transform: translateY(10px); transition: all 0.3s ease; }
.scenario-popup-menu.open { opacity: 1; visibility: visible; transform: translateY(0); }
.scenario-options-wrapper { display: flex; gap: 8px; }
.scenario-option.active { border-color: var(--col-gold); color: var(--col-gold); background-color: var(--col-white-2); }

/* Camera Presets Footer */
.camera-presets-wrapper { flex: 0 0 auto; display: flex; justify-content: flex-start; gap: 15px; padding: 15px 4px 4px 4px; margin-left: -4px; width: calc(100% + 8px); overflow-x: auto; scrollbar-width: none; }
.camera-presets-wrapper::-webkit-scrollbar { display: none; }
.preset-box { width: 85px; height: 60px; border-radius: 6px; background-color: var(--col-white-1); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid var(--col-white-3); flex-shrink: 0; }
.preset-box .preset-label { font-size: 0.75rem; font-weight: 700; color: var(--col-black-2); text-transform: uppercase; }
.preset-box:hover, .preset-box.selected { border-color: var(--col-white-1); box-shadow: 0 0 0 1px var(--col-white-1), 0 0 0 3px var(--col-gold); }

/* FS Nav & Spinners */
.fs-ui-element { opacity: 1; visibility: visible; transition: all 0.4s ease; }
.fs-ui-element.hidden-fs-ui { opacity: 0; visibility: hidden; pointer-events: none; }
.fs-nav-left { position: absolute; top: 50%; left: 15px; transform: translateY(-50%); z-index: 25; }
.fs-nav-right { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); z-index: 25; }
.fs-counter { position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%); background-color: var(--col-white-1); padding: 10px 24px; border-radius: 6px; font-weight: 500; letter-spacing: 2px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); z-index: 25; }
.spinner-canvas, .spinner { border-radius: 50%; animation: spin 0.8s linear infinite; }
.spinner-canvas { width: 40px; height: 40px; border: 4px solid var(--col-white-4); border-top-color: var(--col-gold); }
.spinner { width: 24px; height: 24px; border: 3px solid rgba(0,0,0,0.1); border-top-color: var(--col-gold); }
.spinner-sm { width: 18px; height: 18px; border-width: 2px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Mobile */
@media screen and (max-width: 1024px) {
  .view-controls-vertical { flex-direction: row; bottom: 15px; top: auto; left: 50%; transform: translateX(-50%); }
  .bottom-left-controls { bottom: 15px; left: 15px; right: auto; }
  .scenario-options-wrapper { flex-direction: column; }
}